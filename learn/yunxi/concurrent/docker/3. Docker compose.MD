###### 知识要点
- 使用 maven 构建镜像
- Docker compose


### 一、使用 maven 构建镜像

```xml
<!-- docker的maven插件，官网：https://github.com/spotify/docker-maven-plugin -->
<plugin>
    <groupId>com.spotify</groupId>
    <artifactId>docker-maven-plugin</artifactId>
    <version>1.2.0</version>
    <executions>        
        <execution>            
            <id>build-image</id>            
            <phase>package</phase>            
            <goals>                
               <goal>build</goal>            
            </goals>        
        </execution>    
    </executions> 
    <configuration>
        <!-- 注意imageName一定要是符合正则[a-z0-9-_.]的，否则构建不会成功 -->
        <!-- 详见：https://github.com/spotify/docker-maven-plugin    Invalid repository name ... only [a-z0-9-_.] are allowed-->
        <imageName>mall-tiny/${project.artifactId}:${project.version}</imageName>
        <dockerHost>http://192.168.3.101:2375</dockerHost>
        <baseImage>java</baseImage>
        <entryPoint>["java", "-jar", "/${project.build.finalName}.jar"]</entryPoint>
        <resources>
            <resource>
                <targetPath>/</targetPath>
                <directory>${project.build.directory}</directory>
                <include>${project.build.finalName}.jar</include>
            </resource>
        </resources>
    </configuration>
</plugin>
```

### 相关配置说明：

```java
executions.execution.phase:此处配置了在maven打包应用时构建docker镜像；
imageName：用于指定镜像名称，mall-tiny是仓库名称，${project.artifactId}为镜像名称，${project.version}为镜像版本号；
dockerHost：打包后上传到的docker服务器地址；
baseImage：该应用所依赖的基础镜像，此处为 java；
entryPoint：docker容器启动时执行的命令；
resources.resource.targetPath：将打包后的资源文件复制到该目录；
resources.resource.directory：需要复制的文件所在目录，maven 打包的应用jar包保存在target目录下面；
resources.resource.include：需要复制的文件，打包好的应用jar包。
```

**注意：依赖的基础镜像需要先行下载，否则会出现构建镜像超时的情况，比如我本地并没有java8的镜像，就需要先把镜像pull下来，再用maven插件进行构建。**

### 构建命令

```
mvn clean package docker:build
```

### 二、Docker compose

> 前面我们使用 Docker 的时候，定义 Dockerfile 文件，然后使用 docker build、docker run 等命令操作容器。然而微服务架构的应用系统一般包含若干个微服务，每个微服务一般都会部署多个实例，如果每个微服务都要手动启停，那么效率之低，维护量之大可想而知。
> 使用 Docker Compose 可以轻松、高效的管理容器，它是一个用于定义和运行多容器 Docker 的应用程序工具

**docker-compose 快速对 docker 容器集群进行编排。**

https://www.jianshu.com/p/658911a8cff3

安装：

```
# base=https://
```

